"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[193],{6193:function(e,t,a){a.r(t);var n=a(765),o=a(7313),l=a(5566),r=a.n(l),i=a(8197),s=a(4195),c=a(6968),d=a(6370),u=a(1682),m=a(2084),h=a(6015),g=a(1404),p=a.n(g),x=a(6986),w=a(6573),f=a(6287),y=a(3523),v=a(6135),D=a(6417);let b=[];t.default=(0,v.$j)((e=>({wholeState:e})))((e=>{let{wholeState:t}=e;const[a,l]=(0,o.useState)(""),[g,v]=(0,o.useState)(""),[k,_]=(0,o.useState)(),[Z,j]=(0,o.useState)(),F=(0,o.useRef)(null),[C,I]=(0,o.useState)("Current quarter"),R=[{header:"Uploaded Date",key:"Date"},{header:"ProviderName",key:"ProviderName"},{header:"InvoiceNumber",key:"InvoiceNumber"},{header:"ProviderCIF",key:"ProviderCIF"},{header:"TaxAmount",key:"TaxAmount"},{header:"TaxRate",key:"TaxRate"},{header:"TotalAmount",key:"TotalAmount"}];(0,o.useEffect)((()=>{P(),E(),j(t.customization.userData)}),[t]);const P=()=>{const e=(new Date).getMonth()+1;return console.log("eere"),e>=1&&e<=3?(I("1st quarter"),1):e>=4&&e<=6?(I("2nd quarter"),2):e>=7&&e<=9?(I("3rd quarter"),3):(I("4th quarter"),4)},E=()=>{let e=[];w.Z.post(f.Z.API_URL+"api/users/getdownload").then((a=>{console.log("res",a.data.data,t.customization.auth._id),a.data.data.map(((a,n)=>{if(a.ClientId==t.customization.auth._id){const t=`${new Date(a.Date).getMonth()+1}/${new Date(a.Date).getDate()}/${new Date(a.Date).getFullYear()}`;e.push({key:n+1+"",invoices:a.InvoiceFiles,id:t,name:a.name,cif:a.cif,tax_amount:a.tax_amount+" \u20ac",base_amount:a.base_amount+" \u20ac",total:a.total+" \u20ac",date:a.Date})}})),b=e,e=[],b.map(((t,a)=>{const n=new Date,o=n.getMonth(),l=3*Math.floor(o/3),r=new Date(n.getFullYear(),l,1);console.log("data",t.date),r<new Date(t.date)&&e.push({key:a+1+"",invoices:t.invoices,id:t.id,name:t.name,cif:t.cif,tax_amount:t.tax_amount+" \u20ac",base_amount:t.base_amount+" \u20ac",total:t.total+" \u20ac"})})),_(e)}))},S=(0,o.useRef)(null),T=new(p().Workbook),q=[],z=(e,t,a)=>{t(),l(e[0]),v(a)},B=e=>({filterDropdown:t=>{let{setSelectedKeys:a,selectedKeys:o,confirm:r,clearFilters:u,close:m}=t;return(0,D.jsxs)(i.Z,{style:{padding:8},onKeyDown:e=>e.stopPropagation(),children:[(0,D.jsx)(s.Z,{ref:F,placeholder:`Buscar ${e}`,value:o[0],onChange:e=>a(e.target.value?[e.target.value]:[]),onPressEnter:()=>z(o,r,e),style:{marginBottom:8,display:"block"}}),(0,D.jsxs)(c.Z,{children:[(0,D.jsx)(d.ZP,{type:"primary",onClick:()=>z(o,r,e),icon:(0,D.jsx)(n.Z,{}),size:"small",style:{width:90},children:"Buscar"}),(0,D.jsx)(d.ZP,{onClick:()=>u&&(e=>{e(),l("")})(u),size:"small",style:{width:90},children:"Reiniciar"}),(0,D.jsx)(d.ZP,{type:"link",size:"small",onClick:()=>{r({closeDropdown:!1}),l(o[0]),v(e)},children:"Filtrar"}),(0,D.jsx)(d.ZP,{type:"link",size:"small",onClick:()=>{m()},children:"cerca"})]})]})},filterIcon:e=>(0,D.jsx)(n.Z,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,a)=>a[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=F.current)||void 0===e?void 0:e.select()}),100)},render:t=>g===e?(0,D.jsx)(r(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[a],autoEscape:!0,textToHighlight:t?t.toString():""}):t}),A=[{title:"Date",dataIndex:"id",align:"center"},{title:"Nombre",dataIndex:"name",key:"name",width:"25%",align:"center",...B("name")},{title:"CIF/DNI",dataIndex:"cif",key:"cif",width:"20%",align:"center",...B("cif")},{title:"Importe del impuesto",dataIndex:"tax_amount",align:"center"},{title:"Cantidad base",dataIndex:"base_amount",align:"center"},{title:"Total",dataIndex:"total",align:"center"},{title:"PDF",dataIndex:"pdf",align:"center",render:(e,t)=>(0,D.jsx)(d.ZP,{type:"primary",icon:(0,D.jsx)(x.Z,{}),onClick:()=>(async e=>{console.log("quarter",e);let t="";t=e.invoices;const a=await w.Z.get(f.Z.API_URL+"download",{responseType:"blob",params:{param1:void 0,param2:e.userId,param3:t}}),n=URL.createObjectURL(new Blob([a.data])),o=document.createElement("a");o.href=n,o.download="invoice.pdf",o.click(),URL.revokeObjectURL(n)})(t),children:"PDF"})},{title:"XLS",dataIndex:"xls",align:"center",render:(e,t)=>(0,D.jsx)(d.ZP,{type:"primary",icon:(0,D.jsx)(x.Z,{}),onClick:()=>(async e=>{let t=[],a=1;Z.map((n=>{console.log("whoelDate",e),n.invoice.map((n=>{if(e.invoices.includes(n.FileName)){let e=n;e.no=a,a++,t.push(e)}}))})),console.log("index",t);try{const e=new(p().Workbook),a=e.addWorksheet("1");a.columns=R,a.columns.forEach((e=>{e.width=20,e.alignment={horizontal:"center"}})),t.forEach((e=>{a.addRow(e)}));const n=await e.xlsx.writeBuffer();(0,y.saveAs)(new Blob([n]),"client.xlsx"),u.Z.success({description:"\xc9xito de exportaci\xf3n!",placement:"bottomRight",duration:2})}catch(n){console.log(n),u.Z.error({description:"Exportaci\xf3n fallida!",placement:"bottomRight",duration:2})}})(t),children:"XLS"})}];return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(i.Z,{style:{marginBottom:20},children:(0,D.jsx)(m.Z,{defaultValue:C,style:{width:180},onChange:e=>{let t;console.log(`selected ${e}`),"month"==e?(t=[],b.map(((e,a)=>{const n=new Date,o=new Date(n.getFullYear(),0,1),l=new Date(n.getFullYear(),3,1);console.log("data",e.date),o<new Date(e.date)&&new Date(e.date)<l&&t.push({key:a+1+"",invoices:e.invoices,id:e.id,name:e.name,cif:e.cif,tax_amount:e.tax_amount+" \u20ac",base_amount:e.base_amount+" \u20ac",total:e.total+" \u20ac"})})),_(t)):"quarter"==e?(t=[],b.map(((e,a)=>{const n=new Date,o=new Date(n.getFullYear(),3,1),l=new Date(n.getFullYear(),6,1);console.log("data",e.date),o<new Date(e.date)&&new Date(e.date)<l&&t.push({key:a+1+"",invoices:e.invoices,id:e.id,name:e.name,cif:e.cif,tax_amount:e.tax_amount+" \u20ac",base_amount:e.base_amount+" \u20ac",total:e.total+" \u20ac"})})),_(t)):"semester"==e?(console.log("aaaaa",b),t=[],b.map(((e,a)=>{const n=new Date,o=new Date(n.getFullYear(),6,1),l=new Date(n.getFullYear(),9,1);console.log("data",e.date),o<new Date(e.date)&&new Date(e.date)<l&&t.push({key:a+1+"",invoices:e.invoices,id:e.id,name:e.name,cif:e.cif,tax_amount:e.tax_amount+" \u20ac",base_amount:e.base_amount+" \u20ac",total:e.total+" \u20ac"})})),_(t)):"annual"==e&&(t=[],b.map(((e,a)=>{const n=new Date,o=new Date(n.getFullYear(),9,1),l=new Date(n.getFullYear()+1,0,1);console.log("data",e.date),o<new Date(e.date)&&new Date(e.date)<l&&t.push({key:a+1+"",invoices:e.invoices,id:e.id,name:e.name,cif:e.cif,tax_amount:e.tax_amount+" \u20ac",base_amount:e.base_amount+" \u20ac",total:e.total+" \u20ac"})})),_(t))},options:[{value:"month",label:"1st quarter"},{value:"quarter",label:"2nd quarter"},{value:"semester",label:"3rd quarter"},{value:"annual",label:"4th quarter"}]})}),(0,D.jsx)(h.Z,{columns:A,ref:S,dataSource:k}),(0,D.jsx)(i.Z,{align:"center",children:(0,D.jsx)(d.ZP,{type:"primary",disabled:!0,size:"large",onClick:async()=>{const e=S.current,t=Array.from(e.getElementsByTagName("tr")).map((e=>Array.from(e.getElementsByTagName("td")).map((e=>e.innerText))));for(let n=1;n<t.length;n++)q.push(t[n]);try{const e=T.addWorksheet("agency");e.columns=A,e.columns.forEach((e=>{e.width=20,e.alignment={horizontal:"center"}})),q.forEach((t=>{e.addRow(t)}));const t=await T.xlsx.writeBuffer();(0,y.saveAs)(new Blob([t]),"client.xlsx"),u.Z.success({description:"\xc9xito de exportaci\xf3n!",placement:"bottomRight",duration:2})}catch(a){console.log(a),u.Z.error({description:"Exportaci\xf3n fallida!",placement:"bottomRight",duration:2})}console.log("ttt",t)},children:"Exportar"})})]})}))},6986:function(e,t,a){a.d(t,{Z:function(){return s}});var n=a(7462),o=a(7313),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},r=a(7469),i=function(e,t){return o.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:l}))};var s=o.forwardRef(i)}}]);