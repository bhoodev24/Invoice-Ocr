"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[111],{111:function(e,t,a){a.r(t);var o=a(765),n=a(7313),l=a(5566),r=a.n(l),s=a(1682),i=a(8197),c=a(4195),u=a(6968),d=a(6370),m=a(2084),p=a(6015),h=a(6986),g=a(1404),f=a.n(g),x=a(3523),w=a(6135),F=(a(202),a(6573)),D=a(6287),y=a(6417);t.default=(0,w.$j)((e=>({wholeState:e})))((e=>{let{wholeState:t}=e;const[a,l]=(0,n.useState)(""),[g,w]=(0,n.useState)(""),[v,k]=(0,n.useState)(),b=(0,n.useRef)(null),[_,I]=(0,n.useState)(""),Z=[{header:"No",key:"no"},{header:"Proveedor",key:"ProviderName"},{header:"CIF/DNI Proveedor",key:"ProviderCIF"},{header:"Fecha",key:"InvoiceDate"},{header:"N Factura",key:"InvoiceNumber"},{header:"Impuesto Tasa",key:"TaxRate"},{header:"Base",key:"BaseAmount"},{header:"Imquestos",key:"TaxAmount"},{header:"Total",key:"TotalAmount"}];(0,n.useEffect)((()=>{j()}),[t]);const j=()=>{if(void 0!=t){console.log("whoelstea",t);let e=1,a=[];t.customization.userData.map((t=>{let o=0,n=0,l=0;const r=new Date,s=r.getMonth(),i=3*Math.floor(s/3),c=new Date(r.getFullYear(),i,1);t.invoice.map((e=>{c<new Date(e.Date)&&0==e.downloadFlag&&(o+=parseFloat(e.TaxAmount),n+=parseFloat(e.BaseAmount),l+=parseFloat(e.TotalAmount))})),0!=o&&(a.push({key:e+"",id:e+"",name:t.user.fname+" "+t.user.lname,cif:t.user.cif,tax_amount:o.toFixed(2)+" \u20ac",base_amount:n.toFixed(2)+" \u20ac",total:l.toFixed(2)+" \u20ac",userId:t.user._id}),e++,console.log("tatat",o,n,l))})),k(a),I(a),console.log("ctable",a),e=0}},A=(0,n.useRef)(null);(0,n.useEffect)((()=>{}),[]);const T=(e,t,a)=>{let o=0,n=[];e[0]?(_.map((t=>{1==t[a].includes(e[0])&&n.push(t)})),n.map((e=>{e.id=o+1,o++})),console.log("handle",n),k(n)):(n=_,n.map((e=>{e.no=o+1,o++})),k(n))},C=e=>({filterDropdown:t=>{let{setSelectedKeys:a,selectedKeys:n,confirm:r,clearFilters:s,close:m}=t;return(0,y.jsxs)(i.Z,{style:{padding:8},onKeyDown:e=>e.stopPropagation(),children:[(0,y.jsx)(c.Z,{ref:b,placeholder:`Buscar ${e}`,value:n[0],onChange:e=>a(e.target.value?[e.target.value]:[]),onPressEnter:()=>T(n,0,e),style:{marginBottom:8,display:"block"}}),(0,y.jsxs)(u.Z,{children:[(0,y.jsx)(d.ZP,{type:"primary",onClick:()=>T(n,0,e),icon:(0,y.jsx)(o.Z,{}),size:"small",style:{width:90},children:"Buscar"}),(0,y.jsx)(d.ZP,{onClick:()=>s&&(e=>{e(),l("")})(s),size:"small",style:{width:90},children:"Reiniciar"}),(0,y.jsx)(d.ZP,{type:"link",size:"small",onClick:()=>{r({closeDropdown:!1}),l(n[0]),w(e)},children:"Filtrar"}),(0,y.jsx)(d.ZP,{type:"link",size:"small",onClick:()=>{m()},children:"cerca"})]})]})},filterIcon:e=>(0,y.jsx)(o.Z,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,a)=>a[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.select()}),100)},render:t=>g===e?(0,y.jsx)(r(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[a],autoEscape:!0,textToHighlight:t?t.toString():""}):t}),P=[{title:"No",dataIndex:"id",align:"center"},{title:"Nombre",dataIndex:"name",key:"name",width:"20%",align:"center",...C("name")},{title:"CIF/DNI",dataIndex:"cif",key:"cif",width:"15%",align:"center",...C("cif")},{title:"Importe del impuesto",dataIndex:"tax_amount",align:"center"},{title:"Cantidad base",dataIndex:"base_amount",align:"center"},{title:"Total",dataIndex:"total",align:"center"},{title:"PDF",dataIndex:"pdf",align:"center",render:(e,a)=>(0,y.jsx)(d.ZP,{type:"primary",icon:(0,y.jsx)(h.Z,{}),onClick:()=>(async e=>{const a=new Date,o=a.getMonth(),n=3*Math.floor(o/3),l=new Date(a.getFullYear(),n,1);console.log("record",v,e);let r=[];t.customization.userData.map((t=>{t.user._id==e.userId&&t.invoice.map((e=>{l<new Date(e.Date)&&0==e.downloadFlag&&r.push(e.FileName)}))})),console.log("files",r);const s=r.join(",");console.log("files",s);const i=await F.Z.get(D.Z.API_URL+"download",{responseType:"blob",params:{param1:l,param2:e.userId,param3:s}}),c=URL.createObjectURL(new Blob([i.data])),u=document.createElement("a");u.href=c,u.download="merged.pdf",u.click(),URL.revokeObjectURL(c),URL.revokeObjectURL(c),await F.Z.get(D.Z.API_URL+"api/users/setflaginvoice",{params:{param1:l,param2:e.userId,param3:s,param4:t.customization.auth._id,param5:e.cif,param6:e.name,param7:e.tax_amount,param8:e.base_amount,param9:e.total}}),location.reload(!0)})(a),children:"PDF"})},{title:"XLS",dataIndex:"xls",align:"center",render:(e,a)=>(0,y.jsx)(d.ZP,{type:"primary",icon:(0,y.jsx)(h.Z,{}),onClick:()=>(async e=>{const a=new Date,o=a.getMonth(),n=3*Math.floor(o/3),l=new Date(a.getFullYear(),n,1);let r=[],i=1;t.customization.userData[e.id-1].invoice.map((e=>{if(l<new Date(e.Date)&&0==e.downloadFlag){let t=e;t.no=i,i++,r.push(t)}})),console.log("export",r,e.id);try{const e=new(f().Workbook),t=e.addWorksheet(i+"");i++,t.columns=Z,t.columns.forEach((e=>{e.width=20,e.alignment={horizontal:"center"}})),r.forEach((e=>{t.addRow(e)}));const a=await e.xlsx.writeBuffer();(0,x.saveAs)(new Blob([a]),"client.xlsx"),s.Z.success({description:"\xc9xito de exportaci\xf3n!",placement:"bottomRight",duration:2})}catch(c){console.log(c),s.Z.error({description:"Exportaci\xf3n fallida!",placement:"bottomRight",duration:2})}})(a),children:"XLS"})}];return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.Z,{style:{marginBottom:20},children:(0,y.jsx)(m.Z,{defaultValue:"anual",style:{width:180,display:"none"},onChange:e=>{if(console.log(`selected ${e}`),"month"==e){const e=new Date;let a=1,o=[];t.customization.userData.map((t=>{let n=0,l=0,r=0;t.invoice.map((t=>{new Date(e.getFullYear(),e.getMonth()-1,e.getDate())<new Date(t.Date)&&(n+=parseFloat(t.TaxAmount),l+=parseFloat(t.BaseAmount),r+=parseFloat(t.TotalAmount))})),o.push({key:a+"",id:a+"",name:t.user.fname+" "+t.user.lname,cif:t.user.cif,tax_amount:n.toFixed(2)+" \u20ac",base_amount:l.toFixed(2)+" \u20ac",total:r.toFixed(2)+" \u20ac"}),a++,console.log("tatat",n,l,r)})),k(o)}else if("quarter"==e){const e=new Date;let a=1,o=[];t.customization.userData.map((t=>{let n=0,l=0,r=0;t.invoice.map((t=>{new Date(e.getFullYear(),e.getMonth()-3,e.getDate())<new Date(t.Date)&&(n+=parseFloat(t.TaxAmount),l+=parseFloat(t.BaseAmount),r+=parseFloat(t.TotalAmount))})),o.push({key:a+"",id:a+"",name:t.user.fname+" "+t.user.lname,cif:t.user.cif,tax_amount:n.toFixed(2)+" \u20ac",base_amount:l.toFixed(2)+" \u20ac",total:r.toFixed(2)+" \u20ac"}),a++,console.log("tatat",n,l,r)})),k(o)}else if("semester"==e){const e=new Date;let a=1,o=[];t.customization.userData.map((t=>{let n=0,l=0,r=0;t.invoice.map((t=>{new Date(e.getFullYear(),e.getMonth()-6,e.getDate())<new Date(t.Date)&&(n+=parseFloat(t.TaxAmount),l+=parseFloat(t.BaseAmount),r+=parseFloat(t.TotalAmount))})),o.push({key:a+"",id:a+"",name:t.user.fname+" "+t.user.lname,cif:t.user.cif,tax_amount:n.toFixed(2)+" \u20ac",base_amount:l.toFixed(2)+" \u20ac",total:r.toFixed(2)+" \u20ac"}),a++,console.log("tatat",n,l,r)})),k(o)}else if("annual"==e){const e=new Date;let a=1,o=[];t.customization.userData.map((t=>{let n=0,l=0,r=0;t.invoice.map((t=>{new Date(e.getFullYear(),e.getMonth()-12,e.getDate())<new Date(t.Date)&&(n+=parseFloat(t.TaxAmount),l+=parseFloat(t.BaseAmount),r+=parseFloat(t.TotalAmount))})),o.push({key:a+"",id:a+"",name:t.user.fname+" "+t.user.lname,cif:t.user.cif,tax_amount:n.toFixed(2)+" \u20ac",base_amount:l.toFixed(2)+" \u20ac",total:r.toFixed(2)+" \u20ac"}),a++,console.log("tatat",n,l,r)})),k(o)}},options:[{value:"month",label:"El mes pasado"},{value:"quarter",label:"\xdaltimo cuarto"},{value:"semester",label:"\xdaltimo semestre"},{value:"annual",label:"anual"}]})}),(0,y.jsx)(p.Z,{columns:P,ref:A,dataSource:v,id:"testId"}),(0,y.jsx)(i.Z,{align:"center"})]})}))},6986:function(e,t,a){a.d(t,{Z:function(){return i}});var o=a(7462),n=a(7313),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},r=a(7469),s=function(e,t){return n.createElement(r.Z,(0,o.Z)({},e,{ref:t,icon:l}))};var i=n.forwardRef(s)},202:function(){}}]);