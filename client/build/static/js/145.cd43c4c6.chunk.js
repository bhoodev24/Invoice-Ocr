"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[145],{2145:function(e,t,a){a.r(t);var n=a(7313),s=a(1682),r=a(8197),i=a(4195),l=a(6968),o=a(6370),d=a(9624),c=a(6015),u=a(253),p=a(765),m=a(5566),h=a.n(m),g=a(6573),y=a(6287),x=a(1404),Z=a.n(x),f=a(3523),v=a(2549),j=a(9466),b=a(9666),C=a(2548),w=a(1405),I=a(3071),S=a(3997),k=a.n(S),R=a(2231),P=a(6135),U=a(6417);t.default=(0,P.$j)((e=>({wholeState:e})))((e=>{let{wholeState:t}=e;const[a,m]=(0,n.useState)(""),[x,S]=(0,n.useState)(""),[P,$]=(0,n.useState)(""),[B,F]=(0,n.useState)(""),[D,_]=(0,n.useState)(""),[N,O]=(0,n.useState)(""),[W,A]=(0,n.useState)(""),[L,V]=(0,n.useState)(""),[E,T]=(0,n.useState)(""),[z,M]=(0,n.useState)([]),[G,q]=(0,n.useState)(""),[H,K]=(0,n.useState)(""),[Y,J]=(0,n.useState)(""),[Q,X]=(0,n.useState)(""),[ee,te]=(0,n.useState)(""),[ae,ne]=(0,n.useState)(6),[se,re]=(0,n.useState)(.2),ie=(0,n.useRef)(null),le=(0,n.useRef)(null),oe=new(Z().Workbook),de=[];(0,n.useEffect)((()=>{ce()}),[]);const ce=async()=>{const e=await g.Z.get(y.Z.API_URL+"api/users/userlist"),t=await g.Z.get(y.Z.API_URL+"api/users/invoicelist"),a=await g.Z.get(y.Z.API_URL+"api/users/getclients");let n=e.data,s=0,r=0;const i=new Date;for(let l=0;l<n.length;l++){n[l].key=(0,v.Z)(),n[l].no=l+1,n[l].agency=n[l].agency_id.id,console.log("egege",n[l].agency),n[l].profile="Perfil";for(let e=0;e<t.data.length;e++)t.data[e].UserId==n[l]._id&&new Date(i.getFullYear(),i.getMonth()-12,i.getDate())<new Date(t.data[e].Date)&&s++,t.data[e].UserId==n[l]._id&&new Date(i.getFullYear(),i.getMonth()-1,i.getDate())<new Date(t.data[e].Date)&&r++;n[l].anual=parseFloat(s*n[l].consumption).toFixed(2),n[l].mensual=(r*n[l].consumption).toFixed(2),s=0,r=0}X(n),M(a.data),te(n)},ue=(e,t,a)=>{console.log("selectedKeys",e,a);let n=0,s=[];e[0]?(ee.map((t=>{t[a]==e[0]&&s.push(t)})),s.map((e=>{e.no=n+1,n++})),console.log("handle",s),X(s)):(s=ee,s.map((e=>{e.no=n+1,n++})),X(s))};const pe=e=>({filterDropdown:t=>{let{setSelectedKeys:a,selectedKeys:n,confirm:s,clearFilters:d,close:c}=t;return(0,U.jsxs)(r.Z,{style:{padding:8},onKeyDown:e=>e.stopPropagation(),children:[(0,U.jsx)(i.Z,{ref:ie,placeholder:`Buscar ${e}`,value:n[0],onChange:e=>a(e.target.value?[e.target.value]:[]),onPressEnter:()=>ue(n,0,e),style:{marginBottom:8,display:"block"}}),(0,U.jsxs)(l.Z,{children:[(0,U.jsx)(o.ZP,{type:"primary",onClick:()=>ue(n,0,e),icon:(0,U.jsx)(p.Z,{}),size:"small",style:{width:90},children:"Buscar"}),(0,U.jsx)(o.ZP,{onClick:()=>d&&(e=>{e(),K("")})(d),size:"small",style:{width:90},children:"Reiniciar"}),(0,U.jsx)(o.ZP,{type:"link",size:"small",onClick:()=>{s({closeDropdown:!1}),K(n[0]),J(e)},children:"Filtrar"}),(0,U.jsx)(o.ZP,{type:"link",size:"small",onClick:()=>{c()},children:"cerca"})]})]})},filterIcon:e=>(0,U.jsx)(p.Z,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,a)=>a[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=ie.current)||void 0===e?void 0:e.select()}),100)},render:t=>Y===e?(0,U.jsx)(h(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[H],autoEscape:!0,textToHighlight:t?t.toString():""}):t}),me=[{title:"No",dataIndex:"no",align:"center",width:"5%"},{title:"Agencia",dataIndex:"agency",align:"center",width:"25%",...pe("agency")},{title:"Nombre",dataIndex:"fname",align:"center",width:"15%",...pe("fname")},{title:"CIF/DNI",dataIndex:"cif",align:"center",width:"15%",...pe("cif")},{title:"Contador de cargas anuales",dataIndex:"anual",align:"center",width:"15%"},{title:"Contador de subidas mensuales",dataIndex:"mensual",align:"center",width:"15%"},{title:"Perfil del cliente",dataIndex:"profile",align:"center",render:(e,t)=>(0,U.jsx)(j.rU,{to:"/dashboard/admin/user_profile/"+Q[t.no-1]._id,children:e})}];return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(r.Z,{justify:"space-between",children:[(0,U.jsx)(d.Z,{span:12,children:(0,U.jsx)("h2",{children:"Lista de usuarios"})}),(0,U.jsx)(d.Z,{span:12})]}),(0,U.jsxs)(r.Z,{children:[(0,U.jsx)(d.Z,{span:24,children:(0,U.jsx)(c.Z,{columns:me,ref:le,dataSource:Q,size:"middle"})}),(0,U.jsx)(d.Z,{span:24,children:(0,U.jsx)(r.Z,{align:"center",style:{marginTop:20},children:(0,U.jsx)(o.ZP,{type:"primary",size:"large",onClick:async()=>{const e=le.current,t=Array.from(e.getElementsByTagName("tr")).map((e=>Array.from(e.getElementsByTagName("td")).map((e=>e.innerText))));for(let n=1;n<t.length;n++)de.push(t[n]);try{const e=oe.addWorksheet("agency");e.columns=me,e.columns.forEach((e=>{e.width=20,e.alignment={horizontal:"center"}})),de.forEach((t=>{e.addRow(t)}));const t=await oe.xlsx.writeBuffer();(0,f.saveAs)(new Blob([t]),"user.xlsx"),s.Z.success({description:"\xc9xito de exportaci\xf3n!",placement:"bottomRight",duration:2})}catch(a){console.log(a),s.Z.error({description:"Exportaci\xf3n fallida!",placement:"bottomRight",duration:2})}console.log("ttt",t)},children:"Exportar"})})})]}),(0,U.jsx)(r.Z,{children:(0,U.jsx)(d.Z,{span:24,children:(0,U.jsx)("h2",{children:"Crear Usuario Nuevo"})})}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:a,onChange:e=>{m(e.target.value)},fullWidth:!0,label:"nombre de pila",variant:"standard"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:x,onChange:e=>{S(e.target.value)},fullWidth:!0,label:"apellido",variant:"standard"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:N,onChange:e=>{O(e.target.value)},fullWidth:!0,label:"Impuesto",variant:"standard"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:P,onChange:e=>{$(e.target.value)},fullWidth:!0,label:"CIF/DNI",variant:"standard"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:D,onChange:e=>{_(e.target.value)},fullWidth:!0,label:"IRPF",variant:"standard"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:L,onChange:e=>{V(e.target.value)},fullWidth:!0,label:"Nombre de contacto",variant:"standard"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:W,onChange:e=>{A(e.target.value)},fullWidth:!0,label:"N\xfamero de licencia",variant:"standard"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:E,onChange:e=>{T(e.target.value)},fullWidth:!0,label:"Contacto telefonico",variant:"standard"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(b.Z,{id:"standard-basic",value:B,onChange:e=>{F(e.target.value)},fullWidth:!0,label:"Contacto de correo",variant:"standard"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(C.Z,{fullWidth:!0,labelId:"demo-simple-select-label",id:"demo-simple-select",value:G,onChange:e=>q(e.target.value),children:z.map((e=>(0,U.jsx)(w.Z,{value:e._id,children:e.id},e._id)))})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,align:"center",children:(0,U.jsxs)(r.Z,{style:{alignItems:"center",justifyContent:"center"},children:[(0,U.jsx)(d.Z,{span:12,children:(0,U.jsx)("div",{children:"Cuota mensual"})}),(0,U.jsx)(d.Z,{span:6,children:(0,U.jsx)(u.Z,{min:6,max:1e5,defaultValue:6,value:ae,onChange:e=>{ne(e)}})})]})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)("div",{children:"Contador de subidas mensuales : 0"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,align:"center",children:(0,U.jsxs)(r.Z,{style:{alignItems:"center",justifyContent:"center"},children:[(0,U.jsx)(d.Z,{span:12,children:(0,U.jsx)("div",{children:"Consumo por p\xe1gina"})}),(0,U.jsx)(d.Z,{span:6,children:(0,U.jsx)(u.Z,{min:.2,max:1e5,defaultValue:.2,value:se,onChange:e=>{re(e)}})})]})}),(0,U.jsx)(d.Z,{span:8,style:{alignItems:"center",justifyContent:"center"},children:(0,U.jsx)("div",{children:"Contador de subidas a\xf1o : 0"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(o.ZP,{type:"primary",children:"Enviar notificaci\xf3n"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(o.ZP,{type:"primary",children:"Enviar correo"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(o.ZP,{type:"primary",children:"Crear evento"})}),(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(o.ZP,{type:"primary",children:"Restablecer licencia"})})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8,children:(0,U.jsx)(o.ZP,{type:"primary",children:"Crear alarma"})}),(0,U.jsx)(d.Z,{span:8})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,U.jsx)(d.Z,{span:8}),(0,U.jsx)(d.Z,{span:8})]}),(0,U.jsxs)(r.Z,{justify:"space-evenly",children:[(0,U.jsx)(I.Z,{beforeUpload:function(e){const a=new FileReader;a.onload=async function(){const e=a.result,n=k().parse(e,{header:!0});console.log(n.data),s.Z.success({description:"Registro exitoso!",placement:"bottomRight",duration:2}),n.data.map((async e=>{let a=e;if((await g.Z.post(y.Z.API_URL+"api/users/register1",a)).data){let a={client:e.agency_id,user:e.fname+" "+e.lname+" acaba de registrarse!"};t.customization.socket.emit("Add User",a)}ce()}))},a.readAsText(e)},showUploadList:!1,children:(0,U.jsx)(o.ZP,{type:"primary",icon:(0,U.jsx)(R.Z,{}),children:"Upload CSV File"})}),(0,U.jsx)(o.ZP,{type:"primary",onClick:()=>{if(""==a||""==x||""==P||""==G||""==B||""==E||""==L||""==W||""==N)return s.Z.warning({description:"Tienes que cumplir con todos los campos de valor.",placement:"bottomRight",duration:2});if(!/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(.\w{2,3})+$/.test(B))return s.Z.warning({description:"Please enter a valid email address.",placement:"bottomRight",duration:2});console.log("afafea",G),g.Z.post(y.Z.API_URL+"api/users/add_user",{fname:a,lname:x,cif:P,agency:G,irpf:D,email:B,phone:E,contactName:L,license:W,consumption:se,fee:ae,tax:N}).then((()=>{let e={client:G,user:a+" "+x+" acaba de registrarse!"};t.customization.socket.emit("Add User",e),ce(),s.Z.success({description:" Guardar \xe9xito!",placement:"bottomRight",duration:2})})).catch((e=>{console.log(e)}))},children:"Guardar"})]})]})}))},1405:function(e,t,a){a.d(t,{Z:function(){return I}});var n=a(3366),s=a(7462),r=a(7313),i=a(3061),l=a(1921),o=a(7551),d=a(7592),c=a(7342),u=a(1195),p=a(7999),m=a(4993),h=a(6983),g=a(9273),y=a(7363),x=a(1081),Z=a(7430),f=a(2298);function v(e){return(0,f.Z)("MuiMenuItem",e)}var j=(0,Z.Z)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),b=a(6417);const C=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],w=(0,d.ZP)(p.Z,{shouldForwardProp:e=>(0,d.FO)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.dense&&t.dense,a.divider&&t.divider,!a.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:a}=e;return(0,s.Z)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!a.disableGutters&&{paddingLeft:16,paddingRight:16},a.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${j.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,o.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${j.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,o.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${j.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,o.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,o.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${j.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${j.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${g.Z.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${g.Z.inset}`]:{marginLeft:52},[`& .${x.Z.root}`]:{marginTop:0,marginBottom:0},[`& .${x.Z.inset}`]:{paddingLeft:36},[`& .${y.Z.root}`]:{minWidth:36}},!a.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},a.dense&&(0,s.Z)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${y.Z.root} svg`]:{fontSize:"1.25rem"}}))}));var I=r.forwardRef((function(e,t){const a=(0,c.Z)({props:e,name:"MuiMenuItem"}),{autoFocus:o=!1,component:d="li",dense:p=!1,divider:g=!1,disableGutters:y=!1,focusVisibleClassName:x,role:Z="menuitem",tabIndex:f,className:j}=a,I=(0,n.Z)(a,C),S=r.useContext(u.Z),k=r.useMemo((()=>({dense:p||S.dense||!1,disableGutters:y})),[S.dense,p,y]),R=r.useRef(null);(0,m.Z)((()=>{o&&R.current&&R.current.focus()}),[o]);const P=(0,s.Z)({},a,{dense:k.dense,divider:g,disableGutters:y}),U=(e=>{const{disabled:t,dense:a,divider:n,disableGutters:r,selected:i,classes:o}=e,d={root:["root",a&&"dense",t&&"disabled",!r&&"gutters",n&&"divider",i&&"selected"]},c=(0,l.Z)(d,v,o);return(0,s.Z)({},o,c)})(a),$=(0,h.Z)(R,t);let B;return a.disabled||(B=void 0!==f?f:-1),(0,b.jsx)(u.Z.Provider,{value:k,children:(0,b.jsx)(w,(0,s.Z)({ref:$,role:Z,tabIndex:B,component:d,focusVisibleClassName:(0,i.Z)(U.focusVisible,x),className:(0,i.Z)(U.root,j)},I,{ownerState:P,classes:U}))})}))},2549:function(e,t,a){a.d(t,{Z:function(){return d}});var n={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s;const r=new Uint8Array(16);function i(){if(!s&&(s="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(r)}const l=[];for(let c=0;c<256;++c)l.push((c+256).toString(16).slice(1));function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}var d=function(e,t,a){if(n.randomUUID&&!t&&!e)return n.randomUUID();const s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=s[e];return t}return o(s)}}}]);