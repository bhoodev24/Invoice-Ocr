"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[568],{7568:function(e,a,t){t.r(a);var s=t(7313),n=t(1682),i=t(8197),r=t(4195),l=t(6968),o=t(6370),c=t(9624),d=t(253),u=t(6015),h=t(5566),p=t.n(h),m=t(765),g=t(1404),x=t.n(g),f=t(3523),j=t(9466),Z=t(6135),y=(t(202),t(9666)),v=t(6573),b=t(6287),w=t(6202),C=t(3071),S=t(2231),k=t(6986),R=t(3997),z=t.n(R),_=t(6417);a.default=(0,Z.$j)((e=>({wholeState:e})),{setUserData:w.M})((e=>{let{wholeState:a,setUserData:t}=e;const[h,g]=(0,s.useState)([]),[Z,w]=(0,s.useState)([1]),[R,I]=(0,s.useState)(a.customization.userData),[P,D]=(0,s.useState)(1),[U,B]=(0,s.useState)(""),[W,E]=(0,s.useState)(""),[A,F]=(0,s.useState)(""),[L,N]=(0,s.useState)(""),[T,O]=(0,s.useState)(""),[V,$]=(0,s.useState)(""),[K,q]=(0,s.useState)(""),[G,H]=(0,s.useState)(""),[J,M]=(0,s.useState)(6),[Q,X]=(0,s.useState)(.2);(0,s.useEffect)((()=>{if(void 0!=a){let e=1,t=[];I(a.customization.userData),console.log("ctable",a),a.customization.userData.map((a=>{t.push({_id:a.user._id,key:e+"",id:e+"",name:a.user.fname+" "+a.user.lname,cif:a.user.cif,email:a.user.email,profile:"profil"}),e++})),console.log("whole",t),g(t),e=0}}),[a]);const[Y,ee]=(0,s.useState)(""),[ae,te]=(0,s.useState)(""),se=(0,s.useRef)(null),ne=(0,s.useRef)(null),ie=new(x().Workbook),re=[];const le=(e,a,t)=>{a(),ee(e[0]),te(t)},oe=e=>({filterDropdown:a=>{let{setSelectedKeys:t,selectedKeys:s,confirm:n,clearFilters:c,close:d}=a;return(0,_.jsxs)(i.Z,{style:{padding:8},onKeyDown:e=>e.stopPropagation(),children:[(0,_.jsx)(r.Z,{ref:se,placeholder:`Buscar ${e}`,value:s[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>le(s,n,e),style:{marginBottom:8,display:"block"}}),(0,_.jsxs)(l.Z,{children:[(0,_.jsx)(o.ZP,{type:"primary",onClick:()=>le(s,n,e),icon:(0,_.jsx)(m.Z,{}),size:"small",style:{width:90},children:"Buscar"}),(0,_.jsx)(o.ZP,{onClick:()=>c&&(e=>{e(),ee("")})(c),size:"small",style:{width:90},children:"Reiniciar"}),(0,_.jsx)(o.ZP,{type:"link",size:"small",onClick:()=>{n({closeDropdown:!1}),ee(s[0]),te(e)},children:"Filtrar"}),(0,_.jsx)(o.ZP,{type:"link",size:"small",onClick:()=>{d()},children:"cerca"})]})]})},filterIcon:e=>(0,_.jsx)(m.Z,{style:{color:e?"#1677ff":void 0}}),onFilter:(a,t)=>t[e].toString().toLowerCase().includes(a.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=se.current)||void 0===e?void 0:e.select()}),100)},render:a=>ae===e?(0,_.jsx)(p(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[Y],autoEscape:!0,textToHighlight:a?a.toString():""}):a}),ce=(e,a)=>{switch(a){case"fname":B(e.target.value);break;case"lname":E(e.target.value);break;case"email":H(e.target.value);break;case"cif":F(e.target.value);break;case"iva":N(e.target.value);break;case"irpf":O(e.target.value);break;case"pwd":$(e.target.value);break;case"license":q(e.target.value)}},de={pageSize:30,current:P,total:h.length,showSizeChanger:!1,pageSizeOptions:["20","30"],showTotal:e=>`Total ${e} elementos`,onShowSizeChange:(e,a)=>handleChangePageSize(a)},ue=[{title:"No",dataIndex:"id",align:"center"},{title:"Nombre",dataIndex:"name",align:"center",width:"30%",...oe("name")},{title:"CIF/DNI",dataIndex:"cif",align:"center",width:"30%",...oe("cif")},{title:"Correo electr\xf3nico",dataIndex:"email",align:"center"},{title:"Perfil del cliente",dataIndex:"profile",align:"center",render:(e,a)=>(0,_.jsx)(j.rU,{to:"/dashboard/client/editprofile/"+h[a.id-1]._id,children:e})}];return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(i.Z,{children:(0,_.jsx)(c.Z,{offset:10,span:6,children:(0,_.jsx)("h2",{children:"Crear Usuario Nuevo"})})}),(0,_.jsxs)(i.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:U,onChange:e=>ce(e,"fname"),fullWidth:!0,label:"Nombre",variant:"standard"})}),(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:W,onChange:e=>ce(e,"lname"),fullWidth:!0,label:"apellido",variant:"standard"})})]}),(0,_.jsxs)(i.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:A,onChange:e=>ce(e,"cif"),fullWidth:!0,label:"CIF/DNI",variant:"standard"})}),(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:G,onChange:e=>ce(e,"email"),fullWidth:!0,label:"Correo electronico",variant:"standard"})})]}),(0,_.jsxs)(i.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:T,onChange:e=>ce(e,"irpf"),fullWidth:!0,label:"IRPF",variant:"standard"})}),(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:L,onChange:e=>ce(e,"iva"),fullWidth:!0,label:"IVA",variant:"standard"})})]}),(0,_.jsxs)(i.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:V,onChange:e=>ce(e,"pwd"),fullWidth:!0,label:"contrase\xf1a",variant:"standard"})}),(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(y.Z,{id:"standard-basic",value:K,onChange:e=>ce(e,"license"),fullWidth:!0,label:"license",variant:"standard"})})]}),(0,_.jsxs)(i.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,_.jsx)(c.Z,{span:8,align:"center",children:(0,_.jsxs)(i.Z,{style:{alignItems:"center",justifyContent:"center"},children:[(0,_.jsx)(c.Z,{span:12,children:(0,_.jsx)("div",{children:"Cuota mensual"})}),(0,_.jsx)(c.Z,{span:6,children:(0,_.jsx)(d.Z,{min:6,max:1e5,defaultValue:6,value:J,onChange:e=>{M(e)}})})]})}),(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)("div",{children:"Contador de subidas mensuales : 0"})})]}),(0,_.jsxs)(i.Z,{justify:"space-evenly",style:{marginBottom:10},children:[(0,_.jsx)(c.Z,{span:8,align:"center",children:(0,_.jsxs)(i.Z,{style:{alignItems:"center",justifyContent:"center"},children:[(0,_.jsx)(c.Z,{span:12,children:(0,_.jsx)("div",{children:"Consumo por p\xe1gina"})}),(0,_.jsx)(c.Z,{span:6,children:(0,_.jsx)(d.Z,{min:.2,max:1e5,defaultValue:.2,value:Q,onChange:e=>{X(e)}})})]})}),(0,_.jsx)(c.Z,{span:8,style:{alignItems:"center",justifyContent:"center"},children:(0,_.jsx)("div",{children:"Contador de subidas a\xf1o : 0"})})]}),(0,_.jsxs)(i.Z,{justify:"space-evenly",children:[(0,_.jsx)(c.Z,{span:3}),(0,_.jsx)(c.Z,{span:5,children:(0,_.jsx)(o.ZP,{onClick:()=>{if(""==U||""==W||""==A||""==L||""==G||""==T||""==V||""==K)return n.Z.warning({description:"Tienes que cumplir con todos los campos de valor.",placement:"bottomRight",duration:2});if(!/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(.\w{2,3})+$/.test(G))return n.Z.warning({description:"Please enter a valid email address.",placement:"bottomRight",duration:2});{let e={fname:U,lname:W,cif:A,iva:L,email:G,irpf:T,password:V,consumption:Q,fee:J,license:K,agency_id:a.customization.auth._id};console.log("who",e),v.Z.post(b.Z.API_URL+"api/users/register1",e).then((e=>{n.Z.success({description:"Registro exitoso!",placement:"bottomRight",duration:2}),console.log("olo",a);let s=a;s.customization.userData.push({invoice:[],user:e.data}),console.log("aaa",s.customization),t(s.customization.userData)})).catch((()=>n.Z.error({description:"Registro fallida!",placement:"bottomRight",duration:2})))}},type:"primary",children:"Guardar"})}),(0,_.jsx)(c.Z,{span:6,children:(0,_.jsx)(C.Z,{beforeUpload:function(e){const s=new FileReader;s.onload=async function(){const e=s.result,i=z().parse(e,{header:!0});console.log(i.data);let r=a;n.Z.success({description:"Registro exitoso!",placement:"bottomRight",duration:2}),i.data.map((async e=>{let s=e;s.agency_id=a.customization.auth._id;let n=await v.Z.post(b.Z.API_URL+"api/users/register1",s);console.log("ret",n),r.customization.userData.push({invoice:[],user:n.data}),t(r.customization.userData)}))},s.readAsText(e)},showUploadList:!1,children:(0,_.jsx)(o.ZP,{type:"primary",icon:(0,_.jsx)(S.Z,{}),children:"Upload CSV File"})})}),(0,_.jsx)(c.Z,{span:8,children:(0,_.jsx)(o.ZP,{type:"primary",onClick:()=>{v.Z.get(b.Z.API_URL+"api/users/getWholeUser").then((e=>{if(console.log("res",e),"success"==e.data.status){let a=[];e.data.data.map((e=>{a.push({fname:e.fname,lname:e.lname,email:e.email,cif:e.cif,iva:e.iva,irpf:e.irpf,anual:e.anual,mensual:e.mensual,agency_id:e.agency_id,password:e.password,date:e.date,license:e.license})})),function(e,a){let t="";const s=Object.keys(e[0]);t+=s.join(",")+"\n",e.forEach((e=>{const a=Object.values(e).map((e=>JSON.stringify(e)));t+=a.join(",")+"\n"}));const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(n),r=document.createElement("a");r.setAttribute("href",i),r.setAttribute("download",a),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}(a,"downloadUser.csv"),n.Z.success({description:"Registro exitoso!",placement:"bottomRight",duration:2})}"false"!=e.data.status||n.Z.error({description:"Some errors!",placement:"bottomRight",duration:2})}))},icon:(0,_.jsx)(k.Z,{}),children:"Descargar Plantilla para Importar"})})]}),(0,_.jsx)("br",{}),(0,_.jsxs)(i.Z,{justify:"space-between",style:{marginTop:120},children:[(0,_.jsx)(c.Z,{span:8}),(0,_.jsx)(c.Z,{span:8})]}),(0,_.jsx)(i.Z,{children:(0,_.jsxs)(c.Z,{span:24,children:[(0,_.jsx)(u.Z,{columns:ue,ref:ne,dataSource:h,size:"middle",pagination:de,rowClassName:e=>Z.includes(e.id)?"selected-row":"",onChange:e=>{D(e.current)},onRow:e=>({onClick:()=>(e=>{console.log("handleclick",e.id),w([e.id]),q(R[e.id-1].user.license)})(e)})}),(0,_.jsx)(i.Z,{align:"center",children:(0,_.jsx)(o.ZP,{type:"primary",size:"large",onClick:async()=>{const e=ne.current,a=Array.from(e.getElementsByTagName("tr")).map((e=>Array.from(e.getElementsByTagName("td")).map((e=>e.innerText))));for(let s=1;s<a.length;s++)re.push(a[s]);try{const e=ie.addWorksheet("agency");e.columns=ue,e.columns.forEach((e=>{e.width=20,e.alignment={horizontal:"center"}})),re.forEach((a=>{e.addRow(a)}));const a=await ie.xlsx.writeBuffer();(0,f.saveAs)(new Blob([a]),"user.xlsx"),n.Z.success({description:"\xc9xito de exportaci\xf3n!",placement:"bottomRight",duration:2})}catch(t){console.log(t),n.Z.error({description:"Exportaci\xf3n fallida!",placement:"bottomRight",duration:2})}console.log("ttt",a)},children:"Exportar"})})]})})]})}))},202:function(){}}]);